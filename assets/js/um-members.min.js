var um_members_directory_busy=[];function IsValidJSONString(e){try{JSON.parse(e)}catch(e){return!1}return!0}function um_set_directory_storage(e,r,t,i){if(i||null===sessionStorage.getItem("um_directory_"+um_members_get_unique_id(e)+"_"+r)){var a=t;return"object"==typeof t&&(a=JSON.stringify(t)),sessionStorage.setItem("um_directory_"+um_members_get_unique_id(e)+"_"+r,a),t}return um_get_directory_storage(e,r)}function um_get_directory_storage(e,r){var t=sessionStorage.getItem("um_directory_"+um_members_get_unique_id(e)+"_"+r);return IsValidJSONString(t)?JSON.parse(t):t}function um_delete_directory_storage(e,r){sessionStorage.removeItem("um_directory_"+um_members_get_unique_id(e)+"_"+r)}function um_members_get_unique_id(e){return e.data("unique_id")}function um_is_directory_busy(e){var r=um_members_get_unique_id(e);return void 0!==um_members_directory_busy[r]&&um_members_directory_busy[r]}function um_members_show_preloader(e){um_members_directory_busy[um_members_get_unique_id(e)]=!0,e.find(".um-members-overlay").show()}function um_members_hide_preloader(e){um_members_directory_busy[um_members_get_unique_id(e)]=!1,e.find(".um-members-overlay").hide()}function um_ajax_get_members(i){var a={page:um_get_directory_storage(i,"page"),args:um_members_args,nonce:um_scripts.nonce,referrer_url:window.location.href};i.find(".um-member-directory-sorting-options").length&&(a.sorting=um_get_directory_storage(i,"sorting")),i.find(".um-search-line").length&&(a.general_search=um_get_directory_storage(i,"general_search")),i.find(".um-search-filter").length&&i.find(".um-search-filter").each(function(){var e=jQuery(this);if(e.find(".um-slider").length){null!==(r=um_get_directory_storage(i,"filter_birth_date"))&&(a.birth_date=r,a.is_filters=!0)}else{var r,t=e.find("select").attr("name");null!==(r=um_get_directory_storage(i,"filter_"+t))&&(a[t]=r,a.is_filters=!0)}}),wp.ajax.send("um_get_members",{data:a,success:function(e){um_set_directory_storage(i,"last_data",e,!0),um_build_template(i,e),um_members_hide_preloader(i);var r=wp.template("um-members-pagination");i.find(".um-members-pagination-box").html(r(e)),i.data("total_pages",e.pagination.total_pages)},error:function(e){console.log(e)}})}function um_build_template(e,r){var t=um_get_directory_storage(e,"layout"),i=wp.template("um-member-"+t);e.find(".um-members-grid, .um-members-list").remove(),e.find(".um-members-wrapper").prepend(i(r)),e.addClass("um-loaded"),e.find(".um-members").length&&(UM_Member_Grid(e.find(".um-members")),jQuery(window).trigger("resize")),jQuery(document.body).trigger("um_build_template",[e])}function UM_Member_Grid(e){e.find(".um-member").length&&e.imagesLoaded(function(){e.masonry({itemSelector:".um-member",columnWidth:".um-member",gutter:".um-gutter-sizer"})})}jQuery(document).ready(function(){jQuery(".um-directory").each(function(){var u=jQuery(this);um_members_show_preloader(u);var e=u.data("view_type");if(e=um_set_directory_storage(u,"layout",e),u.find(".um-member-directory-view-type-a").length){var r="list"===e?"um-faicon-list":"um-faicon-th";u.find(".um-member-directory-view-type-a i").attr("class",r);var t="list"===e?"Change to Grid":"Change to List";u.find(".um-member-directory-view-type-a").attr("original-title",t),u.find(".um-member-directory-view-type-a").tipsy("hide").tipsy("show")}if(um_set_directory_storage(u,"page",1),u.find(".um-member-directory-sorting-options").length){var i=um_set_directory_storage(u,"sorting",u.find(".um-member-directory-sorting-options").val());u.find(".um-member-directory-sorting-options").val(i)}var a=!1;if(u.find(".um-search-line").length){var m=um_get_directory_storage(u,"general_search");null!==m?u.find(".um-search-line").val(m):a=!0}u.find(".um-member-directory-sorting-options").length&&(null!==(i=um_get_directory_storage(u,"sorting"))&&u.find(".um-member-directory-sorting-options").val(i).trigger("change"));if(jQuery("#tmpl-um-members-filtered-line").length){var s=um_members_get_unique_id(u),n=[];u.find(".um-search-filter").each(function(){var r,t=jQuery(this),i=t.find("select").attr("name"),a=um_get_directory_storage(u,"filter_"+i),m=t.find("select").data("placeholder");if(void 0!==a&&("string"==typeof a?(r=t.find('select option[value="'+a+'"]').data("value_label"),n.push({name:i,label:m,value_label:r,value:a,unique_id:s})):jQuery.each(a,function(e){r=t.find('select option[value="'+a[e]+'"]').data("value_label"),n.push({name:i,label:m,value_label:r,value:a[e],unique_id:s})})),t.find(".um-slider").length){var e=um_get_directory_storage(u,"filter_birth_date");void 0!==e&&(t.find(".um-slider").slider("option","values",e),t.find(".um_range_min").val(e[0]),t.find(".um_range_max").val(e[1]),t.find(".um-slider-range").html(t.find(".um-slider").slider("values",0)+" - "+t.find(".um-slider").slider("values",1)+" y.o"))}}),u.find(".um-members-filter-tag").remove();var d=wp.template("um-members-filtered-line");u.find(".um-filtered-line").prepend(d({filters:n})),0<n.length?(u.find(".um-filtered-line").show(),a=!1):(u.find(".um-filtered-line").hide(),a=!0)}1===parseInt(u.data("only_search"))&&a?um_members_hide_preloader(u):um_ajax_get_members(u)}),jQuery(document.body).on("click",".um-member-directory-view-type-a",function(){var t=jQuery(this).parents(".um-directory");if(um_is_directory_busy(t))return!1;var e=um_get_directory_storage(t,"layout");um_set_directory_storage(t,"layout",e="grid"===e?"list":"grid",!0),t.data("view_type",e);var r="list"===e?"um-faicon-list":"um-faicon-th";t.find(".um-member-directory-view-type-a i").attr("class",r);var i="list"===e?"Change to Grid":"Change to List";t.find(".um-member-directory-view-type-a").attr("original-title",i),t.find(".um-member-directory-view-type-a").tipsy("hide").tipsy("show");var a=um_get_directory_storage(t,"last_data");if(null!==a)um_build_template(t,a);else{var m=!1;if(t.find(".um-search-line").length)null===um_get_directory_storage(t,"general_search")&&(m=!0);if(jQuery("#tmpl-um-members-filtered-line").length){var u=[];t.find(".um-search-filter").each(function(){var e=jQuery(this).find("select").attr("name"),r=um_get_directory_storage(t,"filter_"+e);void 0!==r&&("string"==typeof r?u.push({name:e}):jQuery.each(r,function(){u.push({name:e})}))}),m=u.length<=0}if(1===parseInt(t.data("only_search"))&&m)return;um_members_show_preloader(t),um_ajax_get_members(t)}}),jQuery(document.body).on("click",".um-directory .pagi:not(.current)",function(){if(!jQuery(this).hasClass("disabled")){var e,r=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(r))um_members_show_preloader(r),1===(e="first"===jQuery(this).data("page")?1:"prev"===jQuery(this).data("page")?1*r.data("page")-1:"next"===jQuery(this).data("page")?1*r.data("page")+1:"last"===jQuery(this).data("page")?parseInt(r.data("total_pages")):parseInt(jQuery(this).data("page")))?(r.find('.pagi[data-page="first"], .pagi[data-page="prev"]').addClass("disabled"),r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').removeClass("disabled")):(e===parseInt(r.data("total_pages"))?r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').addClass("disabled"):r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').removeClass("disabled"),r.find('.pagi[data-page="first"], .pagi[data-page="prev"]').removeClass("disabled")),r.find(".pagi").removeClass("current"),r.find('.pagi[data-page="'+e+'"]').addClass("current"),r.data("page",e),um_set_directory_storage(r,"page",e,!0),um_ajax_get_members(r)}}),jQuery(document.body).on("change",".um-directory .um-members-pagi-dropdown",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=jQuery(this).val();e.find(".pagi").removeClass("current"),e.find('.pagi[data-page="'+r+'"]').addClass("current"),e.data("page",r),um_set_directory_storage(e,"page",r,!0),um_ajax_get_members(e)}}),jQuery(document.body).on("change",".um-member-directory-sorting-options",function(){var t=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(t)){var e=!1;if(t.find(".um-search-line").length)null===um_get_directory_storage(t,"general_search")&&(e=!0);if(jQuery("#tmpl-um-members-filtered-line").length){var i=[];t.find(".um-search-filter").each(function(){var e=jQuery(this).find("select").attr("name"),r=um_get_directory_storage(t,"filter_"+e);void 0!==r&&("string"==typeof r?i.push({name:e}):jQuery.each(r,function(){i.push({name:e})}))}),e=i.length<=0}1===parseInt(t.data("only_search"))&&e||(t.data("sorting",jQuery(this).val()),um_set_directory_storage(t,"sorting",jQuery(this).val(),!0),um_ajax_get_members(t))}}),jQuery(document.body).on("click",".um-do-search",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=e.find(".um-search-line").val();r===um_get_directory_storage(e,"general_search")||""===r&&null===um_get_directory_storage(e,"general_search")||(e.data("general_search",r),um_set_directory_storage(e,"general_search",r,!0),um_ajax_get_members(e))}}),jQuery(document.body).on("keypress",".um-search-line",function(e){13===e.which&&jQuery(this).parents(".um-directory").find(".um-do-search").trigger("click")}),jQuery(".um-member-directory-filters").click(function(){var e=jQuery(this).parents(".um-directory").find(".um-search");e.is(":visible")?e.slideUp(750):e.slideDown(750)}),jQuery(".um-close-filter").click(function(){jQuery(this).parents(".um-directory").find(".um-search").slideUp(750)}),jQuery(document.body).on("change",".um-search-filter select",function(){if(""!==jQuery(this).val()){var u=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(u)){var e=jQuery(this).prop("name"),r=um_get_directory_storage(u,"filter_"+e);null===r&&(r=[]),-1===jQuery.inArray(jQuery(this).val(),r)&&(r.push(jQuery(this).val()),um_set_directory_storage(u,"filter_"+e,r,!0),um_set_directory_storage(u,"page",1,!0)),jQuery(this).val("").trigger("change"),um_ajax_get_members(u);var s=um_members_get_unique_id(u),n=[];u.find(".um-search-filter").each(function(){var r,t=jQuery(this),i=t.find("select").attr("name"),a=um_get_directory_storage(u,"filter_"+i),m=t.find("select").data("placeholder");if(void 0!==a&&("string"==typeof a?(r=t.find('select option[value="'+a+'"]').data("value_label"),n.push({name:i,label:m,value_label:r,value:a,unique_id:s})):jQuery.each(a,function(e){r=t.find('select option[value="'+a[e]+'"]').data("value_label"),n.push({name:i,label:m,value_label:r,value:a[e],unique_id:s})})),t.find(".um-slider").length){var e=um_get_directory_storage(u,"filter_birth_date");void 0!==e&&(t.find(".um-slider").slider("option","values",e),t.find(".um_range_min").val(e[0]),t.find(".um_range_max").val(e[1]),t.find(".um-slider-range").html(t.find(".um-slider").slider("values",0)+" - "+t.find(".um-slider").slider("values",1)+" y.o"))}}),u.find(".um-members-filter-tag").remove();var t=wp.template("um-members-filtered-line");u.find(".um-filtered-line").prepend(t({filters:n})),0<n.length?u.find(".um-filtered-line").show():u.find(".um-filtered-line").hide()}}}),jQuery(document.body).on("click",".um-members-filter-remove",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=jQuery(this).data("value"),t=jQuery(this).data("name"),i=um_get_directory_storage(e,"filter_"+t);null!==i&&-1!==jQuery.inArray(r,i)&&(0<(i=jQuery.grep(i,function(e){return e!==r})).length?um_set_directory_storage(e,"filter_"+t,i,!0):um_delete_directory_storage(e,"filter_"+t),um_set_directory_storage(e,"page",1,!0),jQuery(this).parents(".um-members-filter-tag").remove()),um_ajax_get_members(e),0===e.find(".um-members-filter-remove").length&&e.find(".um-clear-filters-a").remove()}}),jQuery(document.body).on("click",".um-clear-filters-a",function(){var i=jQuery(this).parents(".um-directory");um_is_directory_busy(i)||(i.find(".um-members-filter-remove").each(function(){var r=jQuery(this).data("value"),e=jQuery(this).data("name"),t=um_get_directory_storage(i,"filter_"+e);null!==t&&-1!==jQuery.inArray(r,t)&&(0<(t=jQuery.grep(t,function(e){return e!==r})).length?um_set_directory_storage(i,"filter_"+e,t,!0):um_delete_directory_storage(i,"filter_"+e),i.find(".um-members-filter-tag").remove())}),um_set_directory_storage(i,"page",1,!0),i.find(".um-members-filter-tag").remove(),um_ajax_get_members(i),jQuery(this).remove())});var e=jQuery(".um-slider");e.slider({range:!0,min:parseInt(e.data("min")),max:parseInt(e.data("max")),values:[parseInt(e.data("min")),parseInt(e.data("max"))],create:function(e,r){console.log(r)},slide:function(e,r){jQuery(this).siblings(".um-slider-range").html(r.values[0]+" - "+r.values[1]+" y.o"),jQuery(this).siblings(".um_range_min").val(r.values[0]),jQuery(this).siblings(".um_range_max").val(r.values[1])},stop:function(e,r){var t=jQuery(this).parents(".um-directory");um_is_directory_busy(t)||(um_set_directory_storage(t,"filter_"+jQuery(this).data("field_name"),r.values,!0),um_set_directory_storage(t,"page",1,!0),um_ajax_get_members(t))}}),jQuery(".um-slider-range").each(function(){jQuery(this).html(jQuery(this).siblings(".um-slider").slider("values",0)+" - "+jQuery(this).siblings(".um-slider").slider("values",1)+" y.o"),jQuery(this).siblings(".um_range_min").val(jQuery(this).siblings(".um-slider").slider("values",0)),jQuery(this).siblings(".um_range_max").val(jQuery(this).siblings(".um-slider").slider("values",1))}),jQuery(document.body).on("click",".um-member-more a",function(){var e=jQuery(this).parents(".um-directory"),r=jQuery(this).parents(".um-member");r.find(".um-member-more").hide(),r.find(".um-member-meta").slideDown(function(){r.find(".um-member-less").fadeIn(),e.find(".um-members").length&&UM_Member_Grid(e.find(".um-members"))}),setTimeout(function(){e.find(".um-members").length&&UM_Member_Grid(e.find(".um-members"))},100)}),jQuery(document.body).on("click",".um-member-less",function(){var e=jQuery(this).parents(".um-directory"),r=jQuery(this).parents(".um-member");r.find(".um-member-less").hide(),r.find(".um-member-meta").slideUp(function(){r.find(".um-member-more").fadeIn(),e.find(".um-members").length&&UM_Member_Grid(e.find(".um-members"))})})});